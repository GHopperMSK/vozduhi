<?xml version="1.0" encoding="UTF-8"?>
<modification>
    <id>Add manufacturer description to the model</id>
    <version>1.0</version>
    <vqmver>2.X</vqmver>
    <author>GHopper</author>
    <file name="admin/model/catalog/manufacturer.php">
        <operation>
            <search position="after" regex="false"><![CDATA[
            $manufacturer_id = $this->db->getLastId();
            ]]></search>
            <add trim="false"><![CDATA[
            if (isset($data['manufacturer_description'])) {
                foreach ($data['manufacturer_description'] as $language_id => $value) {
                    $this->db->query("INSERT INTO " . DB_PREFIX . "manufacturer_description SET manufacturer_id = '" . (int)$manufacturer_id . "', language_id = '" . (int)$language_id . "', description = '" . $this->db->escape($value['description']) . "'");
                }
    		}
            ]]></add>
        </operation>
        <operation>
            <search position="after" regex="false"><![CDATA[
            $this->db->query("UPDATE " . DB_PREFIX . "manufacturer SET name
            ]]></search>
            <add trim="false"><![CDATA[
            $this->db->query("DELETE FROM `" . DB_PREFIX . "manufacturer_description` WHERE manufacturer_id = '" . (int)$manufacturer_id . "'");
            if (isset($data['manufacturer_description'])) {
                foreach ($data['manufacturer_description'] as $language_id => $value) {
                    $this->db->query("INSERT INTO " . DB_PREFIX . "manufacturer_description SET manufacturer_id = '" . (int)$manufacturer_id . "', language_id = '" . (int)$language_id . "', description = '" . $this->db->escape($value['description']) . "'");
                }
    		}
            ]]></add>
        </operation>
        <operation>
            <search position="after" regex="false"><![CDATA[
            $this->db->query("DELETE FROM `" . DB_PREFIX . "manufacturer`
            ]]></search>
            <add trim="false"><![CDATA[
            $this->db->query("DELETE FROM `" . DB_PREFIX . "manufacturer_description` WHERE manufacturer_id = '" . (int)$manufacturer_id . "'");
            ]]></add>
        </operation>
        <operation>
            <search position="before" regex="false"><![CDATA[
            public function getManufacturerStores($manufacturer_id) {
            ]]></search>
            <add trim="false"><![CDATA[
            public function getManufacturerDescriptions($manufacturer_id) {
                $manufacturer_description_data = array();

                $query = $this->db->query("SELECT * FROM " . DB_PREFIX . "manufacturer_description WHERE manufacturer_id = '" . (int)$manufacturer_id . "'");

                foreach ($query->rows as $result) {
                    $manufacturer_description_data[$result['language_id']] = array(
                        'description'      => $result['description']
                    );
                }

                return $manufacturer_description_data;
            }
            ]]></add>
        </operation>
    </file>
</modification>
